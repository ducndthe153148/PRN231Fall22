@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
<script src="~/jquery/dist/jquery.js"></script>
<script src="~/jquery/dist/jquery.min.js"></script>
<script src="~/jquery/dist/jquery.slim.js"></script>
<script src="~/jquery/dist/jquery.slim.min.js"></script>


<div class="form-group">
    <label for="Name">Name:</label>
    <input type="text" class="form-control" id="Name" />
</div>
<div class="form-group">
    <label for="Description">Description:</label>
    <input type="text" class="form-control" id="Description" />
</div>
<div class="form-group">
    <label for="Image">Image:</label>
    <input type="text" class="form-control" id="Image" />
</div>
<div class="text-center panel-body">
    <button type="submit" class="btn btn-sm btn-primary" id="AddButton">Add</button>
</div>

<div class="panel panel-primary">
    <div class="panel-heading">
        Get API Data
    </div>
    <div class="panel-body">
        <table class="table table-bordered" id="Table">
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Description</th>
                <td>Edit</td>
            </tr>
        </table>
    </div>

</div>

<script type="text/javascript">
    $(document).ready(function(){
        Manager.GetAllCategories();
    })
    var Manager = {
        GetAllCategories: function(){
            var obj = "";
            var serviceUrl = "http://localhost:5000/api/Categories/list";
            window.Manager.GetAPI(serviceUrl, onSuccess, onFailed);
            function onSuccess(jsonData){
                obj = jsonData;
                $.each(jsonData, function(i, item){
                    var rows = "<tr>" +
                        "<td id = 'CategoryId'>" + item.categoryId + "</td>" +
                        "<td id = 'CategoryName'>" + item.categoryName + "</td>" +
                        "<td id = 'Description'>" + item.description + "</td>" +
                        "<td> " Edit +"</td>" +
                        "</tr>";
                        $('#Table').append(rows);
                });
            }
            function onFailed(error) {
                window.alert(error.statusText);
            }
            return obj;
        },
        GetAPI: function (serviceUrl, successCallback, errorCallback) {
            $.ajax({
                type: "GET",
                url: serviceUrl,
                dataType: "json",
                success: successCallback,
                headers: {
                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJKV1RBY2Nlc3NUb2tlbiIsImp0aSI6IjU4MzQ1MjkxLWE4NzItNDNlOC1iODUxLTAyZTE4NDRjMzIxNiIsImlhdCI6IjEwLzEyLzIwMjIgNDowMzowNSBQTSIsIkFjY291bnRJZCI6IjEiLCJQYXNzd29yZCI6IjEyMyIsIkVtYWlsIjoiY3VzdDFAZ21haWwuY29tIiwiZXhwIjoxNjY1NTkxMTg1LCJpc3MiOiJKV1RBdXRoZW50aWNhdGlvblNlcnZlciIsImF1ZCI6IkNsaWVudEFwcCJ9.u53OAraShi0Rnf4n2p-n5o9I8p4AN-WXZnR43nOOkDk'
                },
                error: errorCallback
            });
        },
    }
    $(document).ready(function () {
        $("#AddButton").click(function (e) {
            $.ajax({
                url: "http://localhost:5000/api/Categories/create",
                type: "post",
                contentType: "application/json",
                data: JSON.stringify({
                    categoryName: $("#Name").val(),
                    description: $("#Description").val(),
                    image: $("#Image").val()
                }),
                success: function (result) {
                    console.log("Thanh cong roi: "+ result)
                },
                error: function (xhr, status, error) {
                    console.log(xhr)
                }
            });
        });
    });
</script>